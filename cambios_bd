-- 20240930 Se agregan tablas de solicitudes credito y solicitudes credito clientes
CREATE TABLE `solicitudes_credito` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `fecha_creacion` datetime DEFAULT NULL,
    `nombre` varchar(255) DEFAULT NULL,
    `persona_tipo_id` int(11) DEFAULT NULL,
    `identificacion_tipo_id` int(11) DEFAULT NULL,
    `documento_numero` varchar(55) DEFAULT NULL,
    `direccion` varchar(255) DEFAULT NULL,
    `telefono` varchar(55) DEFAULT NULL,
    `email` varchar(255) DEFAULT NULL,
    `celular` varchar(55) DEFAULT NULL,
    `representante_legal` varchar(255) DEFAULT NULL,
    `representante_legal_documento_numero` varchar(55) DEFAULT NULL,
    `email_factura_electronica` varchar(255) DEFAULT NULL,
    `tesoreria_nombre` varchar(255) DEFAULT NULL,
    `tesoreria_email` varchar(255) DEFAULT NULL,
    `tesoreria_telefono` varchar(55) DEFAULT NULL,
    `tesoreria_celular` varchar(55) DEFAULT NULL,
    `comercial_nombre` varchar(55) DEFAULT NULL,
    `comercial_email` varchar(255) DEFAULT NULL,
    `comercial_telefono` varchar(55) DEFAULT NULL,
    `comercial_celular` varchar(55) DEFAULT NULL,
    `contabilidad_nombre` varchar(255) DEFAULT NULL,
    `contabilidad_email` varchar(255) DEFAULT NULL,
    `contabilidad_telefono` varchar(55) DEFAULT NULL,
    `contabilidad_celular` varchar(55) DEFAULT NULL,
    `referencia_comercial_entidad1` varchar(255) DEFAULT NULL,
    `referencia_comercial_cel1` varchar(55) DEFAULT NULL,
    `referencia_comercial_direccion1` varchar(255) DEFAULT NULL,
    `referencia_comercial_entidad2` varchar(255) DEFAULT NULL,
    `referencia_comercial_cel2` varchar(55) DEFAULT NULL,
    `referencia_comercial_direccion2` varchar(255) DEFAULT NULL,
    `referencia_bancaria_entidad` varchar(255) DEFAULT NULL,
    `referencia_bancaria_tipo` varchar(255) DEFAULT NULL,
    `referencia_bancaria_numero` varchar(55) DEFAULT NULL,
    `reconocimiento_publico` tinyint(1) DEFAULT NULL,
    `reconocimiento_publico_cual` varchar(255) DEFAULT NULL,
    `persona_expuesta` tinyint(1) DEFAULT NULL,
    `persona_expuesta_cual` varchar(255) DEFAULT NULL,
    `poder_publico` tinyint(1) DEFAULT NULL,
    `poder_publico_cual` varchar(255) DEFAULT NULL,
    `recursos_publicos` tinyint(1) DEFAULT NULL,
    `recursos_publicos_cual` varchar(255) DEFAULT NULL,
    `ingresos_mensuales` double DEFAULT NULL,
    `egresos_mensuales` double DEFAULT NULL,
    `activos` double DEFAULT NULL,
    `pasivos` double DEFAULT NULL,
    `otros_ingresos` double DEFAULT NULL,
    `concepto_otros_ingresos` varchar(255) DEFAULT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `solicitudes_credito_clientes` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `nombre` varchar(255) DEFAULT NULL,
    `identificacion_tipo_id` int(11) DEFAULT NULL,
    `documento_numero` varchar(55) DEFAULT NULL,
    `porcentaje_participacion` int(11) DEFAULT NULL,
    `solicitud_id` int(11) DEFAULT NULL,
    `formulario_tipo` int(11) DEFAULT NULL COMMENT '1: Socios o accionistas; 2: Beneficiarios finales de socios o accionistas iguales o superiores a 5%; 3: Personas autorizadas para brindar información',
    `celular` varchar(55) DEFAULT NULL,
    PRIMARY KEY (`id`),
    KEY `solicitud_id` (`solicitud_id`),
    CONSTRAINT `solicitudes_credito_clientes_ibfk_1` FOREIGN KEY (`solicitud_id`) REFERENCES `solicitudes_credito` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 20241003 SE cambian nombres de tablas anteriormente creadas
RENAME TABLE solicitudes_credito TO clientes_solicitudes_credito;
RENAME TABLE solicitudes_credito_clientes TO clientes_solicitudes_credito_detalle;

-- 20241008 Campo para diferenciar solicitudes nuevas o actualizaciones
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `nueva` tinyint(1) NULL DEFAULT NULL AFTER `concepto_otros_ingresos`;

-- 20241016 Campos nuevos para la solicitud del crédito
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `cantidad_vehiculos` int NULL DEFAULT 0 AFTER `nueva`;
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `preferencia_enlace` tinyint(1) NULL COMMENT '1: Whatsapp; 2: Email' AFTER `cantidad_vehiculos`;

CREATE TABLE `api_tokens` (
    `id` INT(11) NOT NULL AUTO_INCREMENT,
    `user_id` INT(11) NOT NULL,
    `key` VARCHAR(40) NOT NULL,
    `level` INT(2) NOT NULL,
    `ignore_limits` TINYINT(1) NOT NULL DEFAULT '0',
    `is_private_key` TINYINT(1)  NOT NULL DEFAULT '0',
    `ip_addresses` TEXT NULL DEFAULT NULL,
    `date_created` INT(11) NOT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `api_logs` (
    `id` INT(11) NOT NULL AUTO_INCREMENT,
    `uri` VARCHAR(255) NOT NULL,
    `method` VARCHAR(6) NOT NULL,
    `params` TEXT DEFAULT NULL,
    `api_key` VARCHAR(40) NOT NULL,
    `ip_address` VARCHAR(45) NOT NULL,
    `time` INT(11) NOT NULL,
    `rtime` FLOAT DEFAULT NULL,
    `authorized` VARCHAR(1) NOT NULL,
    `response_code` smallint(3) DEFAULT '0',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 20250116 Se agrega nuevo campo en tabla de recibos
ALTER TABLE `recibos` ADD COLUMN `fecha_actualizacion_bot` datetime(0) NULL AFTER `numero_siesa`;

-- 20250125 Logs agregados
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (55, 'Ingresa a contacto por Whatsapp')
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (56, 'Otras transacciones de Wompi - Acceso al webhook')
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (57, 'Webhook - Recibo de Wompi almacenado correctamente')

-- 20250125 Tipo de recibo agregado
INSERT INTO `recibos_tipos` (`id`, `nombre`) VALUES (4, 'Otras transacciones Wompi')

-- 20250208 Rol agregado
INSERT INTO `roles` (`id`, `nombre`, `descripcion`, `modulo_id`) VALUES (7, 'configuracion_comprobantes_ver', 'Ver comprobantes subidos', 2)
INSERT INTO `perfiles_roles` (`fecha_creacion`, `rol_id`, `perfil_id`, `usuario_id`) VALUES ('2025-02-08 16:04:00', 7, 1, 8408)
INSERT INTO `perfiles_roles` (`fecha_creacion`, `rol_id`, `perfil_id`, `usuario_id`) VALUES ('2025-02-08 16:04:00', 7, 2, 8408)

-- 20250208 Log agregado
INSERT INTO `logs_tipos` (`id`,`nombre`) VALUES (58, 'Clientes - Búsqueda de cliente en menú Comprobantes')
INSERT INTO `logs_tipos` (`id`,`nombre`) VALUES (59, 'Clientes - Cliente no encontrado en menú Comprobantes')

-- 20250217 Campos para datos del recibo cuando es comprobante
ALTER TABLE `recibos` ADD COLUMN `cuenta_bancaria_id` int NULL AFTER `numero_siesa`;
ALTER TABLE `recibos` ADD COLUMN `fecha_consignacion` date NULL AFTER `numero_siesa`;
ALTER TABLE `recibos` ADD COLUMN `archivo_soporte` varchar(255) NULL AFTER `cuenta_bancaria_id`;

-- 20250126 Se agregan nuevos campos en las solicitudes de crédito
ALTER TABLE `clientes_solicitudes_credito` 
    ADD COLUMN `nombre` varchar(100) NULL AFTER `fecha_creacion`,
    CHANGE COLUMN `nombre` `razon_social` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL AFTER `fecha_creacion`,
    ADD COLUMN `primer_apellido` varchar(55) NULL AFTER `nombre`,
    ADD COLUMN `segundo_apellido` varchar(55) NULL AFTER `primer_apellido`;
    ADD COLUMN `departamento_id` int NULL AFTER `documento_numero`,
    ADD COLUMN `ciudad_id` int NULL AFTER `departamento_id`,
    ADD COLUMN `fecha_expedicion` date NULL AFTER `fecha_creacion`,
    ADD COLUMN `representante_legal_correo` varchar(255) NULL AFTER `representante_legal_documento_numero`,
    MODIFY COLUMN `fecha_expedicion` date NULL DEFAULT NULL AFTER `documento_numero`,
    ADD COLUMN `tercero_vendedor_id` int NULL AFTER `preferencia_enlace`;

-- 20250412 Se agrega log para los comprobantes eliminados
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (60, 'Recibos - Comprobante eliminado');

-- 20250421 Estado de recibos agregado
INSERT INTO `recibos_estados` (`id`, `nombre`, `clase`, `orden`) VALUES (5, 'Procesado con errores', 'warning', 5);

-- 20250424 Campo agregado para el estado de cuenta del cliente
ALTER TABLE `clientes_facturas` ADD COLUMN `Nro_cuota` int NULL;

-- 20240424 Campo para almacenar el número de cuota en el detalle del recibo
ALTER TABLE `recibos_detalle` ADD COLUMN `cuota_numero` int NULL AFTER `descuento`;

-- 20250424 Campo para almacenar el centro operativo
ALTER TABLE `recibos_detalle` ADD COLUMN `centro_operativo` varchar(255) NULL AFTER `subtotal_lista_sucursal`;

-- 20250424 Campo para almacenar el valor inicial de la factura
ALTER TABLE `recibos_detalle` ADD COLUMN `valor_inicial` double NULL DEFAULT NULL AFTER `unidad_inventario`;

-- 20250507 Modificación en campos
ALTER TABLE `recibos_detalle` 
    DROP COLUMN `valor_inicial`,
    DROP COLUMN `precio_lista_sucursal`,
    DROP COLUMN `subtotal_lista_sucursal`,
    ADD COLUMN `valor_saldo_inicial` double NULL COMMENT 'clientes_facturas.totalCop' AFTER `centro_operativo`,
    ADD COLUMN `valor_abonos` double NULL COMMENT 'clientes_facturas.valorDoc' AFTER `valor_saldo_inicial`,
    ADD COLUMN `valor_factura` double NULL COMMENT 'clientes_facturas.valorAplicado' AFTER `valor_abonos`;

-- 20250514 Campo agregado
ALTER TABLE `recibos` ADD COLUMN `referencia` varchar(50) NULL AFTER `cuenta_bancaria_id`;

-- 20250520 Campo agregado para almacenar la diferencia de valores entre el pagado y el consignado
ALTER TABLE `recibos` ADD COLUMN `valor_pagado_mayor` double NULL DEFAULT 0 AFTER `fecha_actualizacion_bot`;

-- 20250521 Campo agregado
ALTER TABLE `recibos_detalle` ADD COLUMN `documento_cruce_fecha` date NULL AFTER `cuota_numero`;

-- 20250611 Se agregan tablas para las cotizaciones de productos
CREATE TABLE `cotizaciones_solicitudes` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `fecha_creacion` datetime DEFAULT NULL,
    `usuario_id` int(11) DEFAULT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `cotizaciones_detalle` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `cotizacion_id` int(11) DEFAULT NULL,
    `producto_id` int(11) DEFAULT NULL,
    `cantidad` double DEFAULT NULL,
    PRIMARY KEY (`id`),
    KEY `cotizacion_id` (`cotizacion_id`),
    CONSTRAINT `cotizaciones_detalle_ibfk_1` FOREIGN KEY (`cotizacion_id`) REFERENCES `cotizaciones_solicitudes` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 20250613 Nombre de tabla modificado
RENAME TABLE cotizaciones_solicitudes TO proveedores_cotizaciones_solicitudes;
RENAME TABLE cotizaciones_detalle TO proveedores_cotizaciones_solicitudes_detalle;

-- 20250613 Relación de las marcas y proveedores
CREATE TABLE `proveedores_marcas`  (
  `id` int NOT NULL AUTO_INCREMENT,
  `proveedor_nit` varchar(100) NULL,
  `marca_codigo` varchar(255) NULL,
  `fecha_creacion` datetime(0) NULL DEFAULT NULL,
  `usuario_id` int NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
);

ALTER TABLE `proveedores_cotizaciones_solicitudes_detalle` ADD COLUMN `precio` double NULL AFTER `cantidad`;
INSERT INTO `roles` (`id`, `nombre`, `descripcion`, `modulo_id`) VALUES (14, 'configuracion_proveedores_ver', 'Ver módulo', 2);

-- 20250620 Campos creados para saber cuánto tiempo estará disponible la cotización
ALTER TABLE `proveedores_cotizaciones_solicitudes` 
ADD COLUMN `fecha_inicio` date NULL AFTER `usuario_id`,
ADD COLUMN `fecha_fin` date NULL AFTER `fecha_inicio`;

-- 20250620
ALTER TABLE `proveedores_cotizaciones_solicitudes_detalle` DROP COLUMN `precio`;

-- 20250620
CREATE TABLE `proveedores_cotizaciones_detalle` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `cotizacion_id` int(11) DEFAULT NULL,
  `producto_id` int(11) DEFAULT NULL,
  `proveedor_nit` varchar(100) DEFAULT NULL,
  `precio` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 20250627 Campos para logs
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (61, 'Proveedores - Matriz de precios (Generación en Excel)')
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (62, 'Proveedores - Consulta de cotizaciones (contacto no encontrado)')
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (63, 'Proveedores - Envío exitoso de cotización')
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (64, 'Proveedores - Actualización exitosa de cotización')

-- 20250630 Campo para la observación del precio indicado en la cotización
ALTER TABLE `proveedores_cotizaciones_detalle` ADD COLUMN `observacion` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL AFTER `precio`;

-- 20250630 Tipos de logs
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (65, 'Proveedores - Consulta exitosa de cotizaciones');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (66, 'Proveedores - Creación de solicitud de precio');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (67, 'Proveedores - Actualización de solicitud de precio');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (68, 'Proveedores - Creación de maestro');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (69, 'Proveedores - Actualización de maestro');

-- 20250719 A campos de fecha se les agrega hora
ALTER TABLE `proveedores_cotizaciones_solicitudes` 
MODIFY COLUMN `fecha_inicio` datetime NULL DEFAULT NULL AFTER `usuario_id`,
MODIFY COLUMN `fecha_fin` datetime NULL DEFAULT NULL AFTER `fecha_inicio`;

-- 20250719 Campos para almacenar el descuento de las cotizaciones de los proveedores
ALTER TABLE `proveedores_cotizaciones_detalle` 
ADD COLUMN `descuento_porcentaje` double NULL AFTER `precio`,
ADD COLUMN `precio_final` double NULL AFTER `observacion`,
ADD COLUMN `descuento_valor` double NULL AFTER `descuento_porcentaje`;

-- 20250826 Tipo de log para descarga de orden de compra en Excel
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (70, 'Proveedores - Orden de compra (Generación en Excel)');

-- 20250830 Campo para almacenar comentarios del usuario logueado en los recibos con comprobantes
ALTER TABLE `recibos` ADD COLUMN `observaciones` varchar(255) NULL AFTER `comentarios`;

-- 20250831 Campo para almacenar el módulo del contacto
ALTER TABLE `terceros_contactos` ADD COLUMN `modulo_id` int NULL DEFAULT 2 AFTER `email`;

-- 20250908 Valor por defecto en el número de cuota de la factura de un recibo
ALTER TABLE `recibos_detalle` MODIFY COLUMN `cuota_numero` int NULL DEFAULT 0 AFTER `descuento`;

-- 20250910 Campo para almacenar el id del usuario en la solicitud de crédito
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `usuario_id` int NULL AFTER `observaciones`;

-- 20250908 Tabla de estados para las solicitudes de crédito
CREATE TABLE `clientes_solicitudes_credito_estados`  (
  `id` int NOT NULL AUTO_INCREMENT,
  `nombre` varchar(50) NULL,
  PRIMARY KEY (`id`)
);

-- 20250908 Almacenamiento del estado de la solicitud de crédito
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `solicitud_credito_estado_id` int NULL AFTER `tercero_vendedor_id`;

-- 20250909 Almacenamiento dedatos adicionales a la solicitud de crédito
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `usuario_asignado_id` int NULL DEFAULT NULL COMMENT 'Usuario asignado para revisar la solicitud' AFTER `solicitud_credito_estado_id`;
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `motivo_rechazo_id` int NULL AFTER `usuario_asignado_id`;
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `observaciones` varchar(255) NULL AFTER `motivo_rechazo_id`;

-- 20250909 Campo para diferenciar los motivos de rechazo a qué interfaz pertenecen
ALTER TABLE `motivos_rechazo` ADD COLUMN `interfaz_id` int NULL DEFAULT 1 COMMENT '1: Pago con comprobantes; 2: Solicitudes de crédito' AFTER `nombre`;

-- 20250914 Se agrega campo para indicar fecha de envío de la firma para solicitudes de crédito
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `fecha_envio_firma` datetime(0) NULL AFTER `usuario_id`;

-- 20250915 Tipo de log para recibir eventos de un envío
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (71, 'Webhook - Evento de un envío (Roa Transportes) recibido')

-- 20250915 Campos adicionales para las solicitudes de crédito
ALTER TABLE `clientes_solicitudes_credito_estados` ADD COLUMN `clase` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL AFTER `nombre`;
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `fecha_cierre` datetime(0) NULL DEFAULT NULL AFTER `fecha_envio_firma`;
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `cupo_asignado` double NULL DEFAULT 0 AFTER `fecha_cierre`;

-- 20250908 Valor por defecto en el número de cuota de la factura de un recibo
ALTER TABLE `recibos_detalle` MODIFY COLUMN `cuota_numero` int NULL DEFAULT 0 AFTER `descuento`;

-- 20250918 Nuevos tipos de logs
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (72, 'WMS - Pedidos (Ejecución de script erróneo)');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (73, 'WMS - Pedidos (Ejecución de script exitoso)');

CREATE TABLE `wms_pedidos`  (
  `FechaDocumento` date NULL,
  `NumeroDocumento` varchar(20) NULL,
  `NIT` varchar(50) NULL,
  `RazonSocial` varchar(255) NULL,
  `Bodega` varchar(10) NULL,
  `CodProducto` int NULL,
  `CantPedida` double NULL,
  `CantidadPendiente` double NULL,
  `PorcentajeIva` double NULL,
  `PorcentajeDescuento` double NULL,
  `FechaIngresoDocumento` date NULL,
  `HoraIngresoDocumento` time(0) NULL,
  `IdConsecutivo` int NULL,
  `NombreConsecutivo` varchar(100) NULL,
  `FechaCreacion` datetime(0) NULL COMMENT 'Fecha de creación del registro'
);

ALTER TABLE `wms_pedidos` MODIFY COLUMN `FechaCreacion` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Fecha de creación del registro' AFTER `NombreConsecutivo`;

-- 20250920 Tabla para almacenar las cuentas por cobrar de los terceros
CREATE TABLE `api_cuentas_por_pagar`  (
    `id` int NOT NULL AUTO_INCREMENT,
    `f353_rowid` int NULL,
    `f353_id_cia` varchar(5) NULL,
    `f353_id_co_cruce` varchar(5) NULL,
    `f353_id_tipo_docto_cruce` int NULL,
    `f353_consec_docto_cruce` int NULL,
    `f350_id_periodo` varchar(10) NULL,
    `f202_id_sucursal` varchar(5) NULL,
    `f253_id` int NULL,
    `f353_total_cr` double NULL,
    `f353_total_db` double NULL,
    `f353_notas` text NULL,
    `f353_id_un_cruce` varchar(5) NULL,
    `f253_ind_sa` int NULL,
    `fecha_creacion` varchar(255) NULL,
    PRIMARY KEY (`id`)
);

-- 20250920 Se agrega tabla para la bitacora de las solicitudes de crédito
CREATE TABLE `clientes_solicitudes_credito_bitacora` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `solicitud_id` int(11) DEFAULT NULL,
  `observaciones` text DEFAULT NULL,
  `usuario_id` int(11) DEFAULT NULL,
  `fecha_creacion` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `solicitud_id` (`solicitud_id`),
  CONSTRAINT `clientes_solicitudes_credito_bitacora_ibfk_1` FOREIGN KEY (`solicitud_id`) REFERENCES `clientes_solicitudes_credito` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 20250920 Campo para crear la firma
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `fecha_firma` datetime(0) NULL AFTER `fecha_envio_firma`;

-- 20250921 Se modifican campos de la tabla api cuentas por pagar
ALTER TABLE `api_cuentas_por_pagar`
ADD COLUMN `f353_nro_cuota_cruce` int NULL AFTER `f350_id_periodo`,
ADD COLUMN `f353_fecha` date NULL AFTER `f353_nro_cuota_cruce`,
ADD COLUMN `f353_fecha_cancelacion` date NULL AFTER `f353_fecha`,
ADD COLUMN `f353_fecha_vcto` date NULL AFTER `f353_fecha_cancelacion`,
ADD COLUMN `f353_fecha_dscto_pp` date NULL AFTER `f353_fecha_vcto`,
ADD COLUMN `f200_id` varchar(20) NULL AFTER `f353_fecha_dscto_pp`,
MODIFY COLUMN `fecha_creacion` datetime(0) NULL DEFAULT NULL AFTER `f253_ind_sa`;

-- 20250921 Se agregan logs
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (74, 'Cuentas por pagar - Ejecución de script erróneo');
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (75, 'Cuentas por pagar - Ejecución de script exitoso');
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (76, 'Cuentas por pagar - Ejecución exitosa del webhook para importar los datos');
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (77, 'Cuentas por pagar - Ocurrió un error ejecutando webhook para importar los datos');
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (78, 'Cuentas por pagar - Consulta de cuentas por pagar');
INSERT INTO `logs_tipos`(`id`, `nombre`) VALUES (79, 'Cuentas por pagar - Consulta de cuentas por pagar (tercero no encontrado)');

-- 20250922 La fecha de creación es la estampa de fecha
ALTER TABLE `api_cuentas_por_pagar` MODIFY COLUMN `fecha_creacion` timestamp NULL DEFAULT CURRENT_TIMESTAMP AFTER `f253_ind_sa`;

-- 20250922 Creación de nuevos tipos de logs
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (80, 'Tercero - Error en la creación del registro al aprobar crédito');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (81, 'Tercero - Creación exitosa del registro al aprobar crédito');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (82, 'Tercero - Error en la creación desde el formulario de registro');

-- 20250922 Tabla para almacenar el tracking de los pedidos
CREATE TABLE `wms_pedidos_tracking`  (
    `Id` int NOT NULL,
    `IdConsecutivo` int NULL,
    `NroDcto` varchar(20) NULL,
    `OrdenExterna` varchar(50) NULL,
    `Estado` varchar(100) NULL,
    `Observaciones` text NULL,
    `Fecha` datetime(0) NULL,
    `IdUsuario` int NULL,
    PRIMARY KEY (`Id`)
);

INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (83, 'WMS - Tracking de pedidos (Ejecución de script exitoso)');

-- 20250927 Ajustes para que el proveedor vea sus facturas
INSERT INTO `perfiles` (`id`, `activo`, `es_administrador`, `descripcion`, `nombre`, `usuario_id`, `token`) VALUES (6, 1, 0, 'Proveedor', 'Proveedor', 1, 'rt8Pr0vd00f');
INSERT INTO `roles` (`id`, `nombre`, `descripcion`, `modulo_id`) VALUES (15, 'proveedores_ver_facturas', 'Ver facturas', 6);
INSERT INTO `perfiles_roles` (`fecha_creacion`, `rol_id`, `perfil_id`, `usuario_id`) VALUES ('2025-09-27 13:08:37', 15, 6, 8408);
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (84, 'Proveedores - Comprobante de Egreso (Generación en Excel)');

-- 20290929 Nuevos logs
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (85, 'Proveedores - Ejecución de script erróneo de movimientos contables');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (86, 'Proveedores - Ejecución de script exitoso de movimientos contables');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (87, 'Proveedores - Consulta exitosa de movimientos de una factura');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (88, 'Proveedores - Ocurrió un error consultando los movimientos de una factura');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (89, 'Proveedores - Consulta de movimientos de una factura (tercero no encontrado)');
INSERT INTO `logs_tipos` (`id`, `nombre`) VALUES (90, 'Proveedores - Certificado de retenciones (Generación en PDF)');

ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `token` varchar(10) NULL AFTER `cupo_asignado`;
ALTER TABLE `clientes_solicitudes_credito` ADD UNIQUE INDEX `documento_numero`(`documento_numero`, `token`) USING BTREE;

-- 20251008 Campo para almacenar el vendedor
ALTER TABLE `recibos` ADD COLUMN `tercero_vendedor_nit` varchar(55) NULL AFTER `valor_pagado_mayor`;

-- 20251004
ALTER TABLE `centros_operacion` ADD COLUMN `ruta` varchar(50) NULL AFTER `estado`;

-- 20251013 Campos para la asignación automática de una solicitud de crédito
ALTER TABLE `usuarios` ADD COLUMN `esta_disponible` tinyint(1) NULL DEFAULT 0 COMMENT 'Marca si está disponible para que se le asignen solicitudes de crédito' AFTER `celular`;
ALTER TABLE `usuarios` ADD COLUMN `fecha_ultima_actividad` datetime(0) NULL COMMENT 'Fecha de la última actividad del usuario' AFTER `esta_disponible`;
ALTER TABLE `usuarios` ADD COLUMN `solicitudes_atendidas` int NULL DEFAULT 0 COMMENT 'Cantidad de solicitudes de crédito atendidas por el usuario' AFTER `fecha_ultima_actividad`;
ALTER TABLE `clientes_solicitudes_credito` ADD COLUMN `usuario_asignado_automaticamente` tinyint(1) NULL DEFAULT 0 COMMENT '0: No; 1: Sí;' AFTER `usuario_asignado_id`;

INSERT INTO `modulos` (`id`, `nombre`, `descripcion`) VALUES (8, 'clientes', 'Clientes');
INSERT INTO `roles` (`id`, `nombre`, `descripcion`, `modulo_id`) VALUES (17, 'clientes_asignacion_automatica_solicitudes_credito', 'Asignación automática de solicitudes de crédito', 8);